process RAW2DIGI = {

    include "FWCore/MessageService/data/MessageLogger.cfi"
    replace MessageLogger.cout.threshold = "ERROR"
    replace MessageLogger.cerr.default.limit = 10
    
    # DQM service
    service = DaqMonitorROOTBackEnd{ }
    
    untracked PSet maxEvents = {untracked int32 input = 76186}

    source = NewEventStreamFileReader {
      untracked vstring fileNames = { 

      }
      untracked vstring streams = {
         'HCAL_DCC719','HCAL_DCC721','HCAL_DCC723','HCAL_Trigger','HCAL_DCC700','HCAL_QADCTDC','HCAL_SlowData'
      }
      int32 max_event_size = 7000000
      int32 max_queue_depth = 5
    } 

    module hcalTBUnpacker = HcalTBObjectUnpacker {
	untracked int32 HcalTriggerFED  = 1
	untracked int32 HcalSlowDataFED = 3
	untracked int32 HcalTDCFED      = 8
	untracked int32 HcalQADCFED      = 8
	untracked int32 HcalSourcePosFED = -1
	untracked bool IncludeUnmatchedHits = false
	untracked string ConfigurationFile = 'configQADCTDC.txt'
    }

    module esRawToDigiTB = ESRawToDigiTB {
	string Label = "source"
	string InstanceES = ""
	string ESdigiCollection = ""
	untracked bool debugMode = false
    }

    module esDigiToRecHitTB =  ESRecHitProducerTB{
        InputTag ESdigiCollection = esRawToDigiTB
        string ESrechitCollection = "EcalRecHitsES"
        untracked int32 ESGain = 2
        untracked double ESMIPADC = 50
        untracked double ESMIPkeV = 81.08
        untracked bool doCM = true
	untracked double SigmaForCM = 4
        #untracked string PedestalFile = "/preshower/DQM/TB/00000999/ESPedestalTB_00000999.root"
	untracked string PedestalFile = "/preshower/DQM/TB/ESPedestalTB_00000999.root"
    }

    path p = { hcalTBUnpacker, esRawToDigiTB, esDigiToRecHitTB }
    #path p = { hcalTBUnpacker, esRawToDigiTB }
    
    module RAWDIGI = PoolOutputModule {
	untracked string fileName = "/esdata/pcphese02/ntuple/testRAWDigiRHit_TB_00000000.root"
    }

    endpath outpath = { RAWDIGI }
    }

}
